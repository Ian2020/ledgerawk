#!/bin/env bash
#
# Usage: $0 [institution] FILE
#
# Available institutions:
#   santander
#   usbank
# 
# FILE should be the copied transactions from your bank.

# TODO: Check institution supplied is valid
TMP="$(mktemp -d -t)/"
FILENAME=$(basename "$2")
echo "Results will be in $TMP"
./reader_"${1}" "$2" > "$TMP${FILENAME}_intermediate.txt" &&
sort -gr < "$TMP${FILENAME}_intermediate.txt" > "$TMP${FILENAME}_intermediate_sorted.txt" &&
./ledgerimport "$TMP${FILENAME}_intermediate_sorted.txt" > "$TMP${FILENAME}" &&
./postings.sh "$TMP${FILENAME}" > "${TMP}import_${FILENAME}"
$EDITOR "${TMP}import_${FILENAME}"
